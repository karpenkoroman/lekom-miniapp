<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>–õ–ï–ö–û–ú ¬∑ –ê—É–¥–∏—Ç –ø–µ—á–∞—Ç–∏</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;margin:0;background:#0f1115;color:#f5f7fb}
  .wrap{max-width:900px;margin:0 auto;padding:20px}
  .card{background:#12151c;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.3);padding:20px}
  h1{margin:0 0 6px;font-size:22px}
  .sub{color:#9aa0a6;margin-bottom:8px}
  .meta{font-size:13px;color:#9aa0a6;margin-bottom:12px}
  .q{border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px;margin:12px 0;background:rgba(255,255,255,.03)}
  .q legend{font-weight:700;margin-bottom:8px}
  .opt{display:flex;gap:10px;align-items:flex-start;margin:8px 0}
  .progress{height:8px;background:#2a2f3a;border-radius:8px;overflow:hidden;margin:10px 0}
  .bar{height:100%;width:0;background:#0a84ff;transition:width .2s ease}
  .hint{font-size:12px;color:#9aa0a6}
  .result{display:none;margin-top:16px;padding:16px;border-left:4px solid #0a84ff;background:rgba(10,132,255,.08);border-radius:10px}
  .cta{display:inline-block;text-decoration:none;padding:12px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .cta.primary{background:#0a84ff;color:#fff}
  .cta.secondary{background:#1e2533;color:#fff}
  #leadForm{display:none;margin-top:20px}
  #leadForm input,#leadForm textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #334155;background:#0e1420;color:#fff}
  #sendLead{background:#0a84ff;color:#fff;font-weight:700;padding:12px;border:none;border-radius:10px;cursor:pointer;width:100%;margin-top:8px}
  #leadMsg{margin-top:10px;color:#7dd3fc;display:none}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>–ê—É–¥–∏—Ç –ø–µ—á–∞—Ç–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã</h1>
    <div class="sub">–ù–µ—É–¥–æ–±–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ IT-–¥–∏—Ä–µ–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–¥–∞—Ç—å —Å–∞–º —Å–µ–±–µ</div>
    <div class="meta">‚è± ~5 –º–∏–Ω—É—Ç ¬∑ –û—Ç–≤–µ—Ç—ã –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã</div>

    <div class="progress"><div id="bar" class="bar"></div></div>
    <div id="pc" class="hint">0/11</div>

    <form id="f">
      <!-- –≤–æ–ø—Ä–æ—Å—ã 1‚Äì11 –æ–ø—É—â–µ–Ω—ã —Ä–∞–¥–∏ –∫—Ä–∞—Ç–∫–æ—Å—Ç–∏; –æ—Å—Ç–∞–≤—å —Å–≤–æ–π –±–ª–æ–∫ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ -->
    </form>

    <button id="fallbackSubmit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±—Ä–∞—É–∑–µ—Ä)</button>

    <div id="res" class="result">
      <h3 id="resTitle">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç</h3>
      <div id="resText" class="hint"></div>
      <div class="ctas">
        <a class="cta primary" target="_blank" href="https://t.me/chelebaev">üí¨ –û–±—Å—É–¥–∏—Ç—å —Å —ç–∫—Å–ø–µ—Ä—Ç–æ–º</a>
        <a id="ctaContact" class="cta secondary">üì© –û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã</a>
      </div>
    </div>

    <div id="leadForm">
      <h3>–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</h3>
      <input id="name" placeholder="–í–∞—à–µ –∏–º—è">
      <input id="company" placeholder="–ö–æ–º–ø–∞–Ω–∏—è">
      <input id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ email">
      <textarea id="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" rows="3"></textarea>
      <div class="hint">–û—Ç–ø—Ä–∞–≤–ª—è—è –¥–∞–Ω–Ω—ã–µ, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å <a href="https://lekom.ru/politika-konfidencialnosti/" target="_blank">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.</div>
      <button id="sendLead">üì© –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã</button>
      <div id="leadMsg">‚úÖ –°–ø–∞—Å–∏–±–æ! –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã.</div>
    </div>
  </div>
</div>

<script>
const tg = window.Telegram?.WebApp;
if (tg){tg.ready();tg.expand();tg.MainButton.enable();}

const params = new URLSearchParams(location.search);
const GAS_HOOK = params.get('hook') || '';

// --- —á–∏—Ç–∞–µ–º startapp-–ø–∞—Ä–∞–º–µ—Ç—Ä ---
const startParam = new URLSearchParams(location.search).get('tgWebAppStartParam') || '';
const CODEMAP = {
  tgpost_oct25: {utm_source:'telegram',utm_medium:'post',utm_campaign:'audit_lekom_oct2025'}
};
const map = CODEMAP[startParam] || {};
const UTM = {
  utm_source: map.utm_source || params.get('utm_source') || '',
  utm_medium: map.utm_medium || params.get('utm_medium') || '',
  utm_campaign: map.utm_campaign || params.get('utm_campaign') || ''
};

// --- –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ---
const qGroups = [...document.querySelectorAll('form fieldset.q')];
const total = qGroups.length;
function answered(){return qGroups.reduce((n,fs)=>n+(fs.querySelector('input:checked')?1:0),0)}
function ui(){const d=answered();bar.style.width=Math.round(d/Math.max(1,total)*100)+'%';pc.textContent=d+'/'+total; if(tg){d===total?tgbShow():tgbHide();}}
function tgbShow(){try{tg.MainButton.setText('–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç');tg.MainButton.show();}catch{}}
function tgbHide(){try{tg.MainButton.hide();}catch{}}
document.addEventListener('change',ui,true);
document.addEventListener('DOMContentLoaded',()=>setTimeout(ui,200));

async function postToGAS(url,obj){
  const body=JSON.stringify(obj);
  try{if(navigator.sendBeacon){if(navigator.sendBeacon(url,new Blob([body],{type:'text/plain'})))return true;}}
  catch{};try{await fetch(url,{method:'POST',mode:'no-cors',body});return true;}catch{}
}

async function submit(){
  const answers={},qfs=document.querySelectorAll('form fieldset.q');let score=0;
  qfs.forEach((fs,i)=>{const c=fs.querySelector('input:checked');const v=Number(c?c.value:0);answers['q'+(i+1)]=v;if(v===1)score++;});
  let verdict,advice,icon;
  if(score>=8){icon='‚≠êÔ∏è';verdict='–ó—Ä–µ–ª–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞';advice='–¢–æ—á–µ—á–Ω—ã–π –∞—É–¥–∏—Ç TCO –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ¬´–¥–ª–∏–Ω–Ω–æ–≥–æ —Ö–≤–æ—Å—Ç–∞¬ª.';}
  else if(score>=5){icon='‚ö†Ô∏è';verdict='–ö–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—Ç–∏—á–Ω—ã–π';advice='–ü–µ—Ä–µ—Å–º–æ—Ç—Ä –±—é–¥–∂–µ—Ç–∞, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª–∏—Ç–∏–∫–∏ –∏ KPI (TCO, SLA).';}
  else{icon='‚ùóÔ∏è';verdict='–í—ã—Å–æ–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å';advice='–≠–∫—Å–ø—Ä–µ—Å—Å-–∞—É–¥–∏—Ç, –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è, –±—ã—Å—Ç—Ä—ã–µ –º–µ—Ä—ã —ç–∫–æ–Ω–æ–º–∏–∏.';}
  window.__lastResult={score,verdict,advice,answers};

  if(GAS_HOOK) await postToGAS(GAS_HOOK,{type:'result',...window.__lastResult,t:new Date().toISOString(),initData:tg?.initDataUnsafe||null});
  resTitle.textContent=`–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${icon} ${score}/${total} ‚Äî ${verdict}`;
  resText.textContent=advice;res.style.display='block';
  if(tg){tg.MainButton.setText('–ó–∞–∫—Ä—ã—Ç—å');tg.onEvent('mainButtonClicked',()=>tg.close());tg.MainButton.show();}
}

if(tg) tg.onEvent('mainButtonClicked',submit);
fallbackSubmit.addEventListener('click',submit);
ctaContact.addEventListener('click',()=>{leadForm.style.display='block';leadForm.scrollIntoView({behavior:'smooth'});});

sendLead.addEventListener('click',async()=>{
  const name=name.value.trim(),company=company.value.trim(),phone=phone.value.trim(),comment=comment.value.trim();
  if(!name&&!phone){alert('–£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –∏–º—è –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω/email');return;}
  const lead={type:'lead',name,company,phone,comment,consent:true,policyUrl:'https://lekom.ru/politika-konfidencialnosti/',result:window.__lastResult||null,t:new Date().toISOString(),initData:tg?.initDataUnsafe||null,...UTM};
  if(GAS_HOOK) await postToGAS(GAS_HOOK,lead);
  leadMsg.style.display='block';sendLead.disabled=true;
});
</script>
</body>
</html>
